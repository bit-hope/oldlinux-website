diff -r linux/boot/bootsect.s linux.org/boot/bootsect.s
45,46c45,46
< entry _start
< _start:
---
> entry start
> start:
228,232c228,232
< !/*
< ! * This procedure turns off the floppy drive motor, so
< ! * that we enter the kernel in a known state, and
< ! * don't have to worry about it later.
< ! */
---
> /*
>  * This procedure turns off the floppy drive motor, so
>  * that we enter the kernel in a known state, and
>  * don't have to worry about it later.
>  */
diff -r linux/boot/head.s linux.org/boot/head.s
15,17c15,16
< .globl idt,gdt,pg_dir,tmp_floppy_area
< pg_dir:
< .globl startup_32
---
> .globl _idt,_gdt,_pg_dir,_tmp_floppy_area
> _pg_dir:
24c23
< 	lss stack_start,%esp
---
> 	lss _stack_start,%esp
32c31
< 	lss stack_start,%esp
---
> 	lss _stack_start,%esp
38d36
< 
86c84
< 	lea idt,%edi
---
> 	lea _idt,%edi
134c132
< tmp_floppy_area:
---
> _tmp_floppy_area:
142c140
< 	pushl $main
---
> 	pushl $_main
164c162
< 	call printk
---
> 	call _printk
205,208c203,206
< 	movl $pg0+7,pg_dir		/* set present bit/user r/w */
< 	movl $pg1+7,pg_dir+4		/*  --------- " " --------- */
< 	movl $pg2+7,pg_dir+8		/*  --------- " " --------- */
< 	movl $pg3+7,pg_dir+12		/*  --------- " " --------- */
---
> 	movl $pg0+7,_pg_dir		/* set present bit/user r/w */
> 	movl $pg1+7,_pg_dir+4		/*  --------- " " --------- */
> 	movl $pg2+7,_pg_dir+8		/*  --------- " " --------- */
> 	movl $pg3+7,_pg_dir+12		/*  --------- " " --------- */
226c224
< 	.long idt
---
> 	.long _idt
231c229
< 	.long gdt		# magic number, but it works for me :^)
---
> 	.long _gdt		# magic number, but it works for me :^)
233,234c231,232
< 	.align 8
< idt:	.fill 256,8,0		# idt is uninitialized
---
> 	.align 3
> _idt:	.fill 256,8,0		# idt is uninitialized
236c234
< gdt:	.quad 0x0000000000000000	/* NULL descriptor */
---
> _gdt:	.quad 0x0000000000000000	/* NULL descriptor */
diff -r linux/boot/setup.s linux.org/boot/setup.s
41a42
> 
188a190
> 
diff -r linux/fs/bitmap.c linux.org/fs/bitmap.c
17c17
< 	::"a" (0),"c" (BLOCK_SIZE/4),"D" ((long) (addr)))
---
> 	::"a" (0),"c" (BLOCK_SIZE/4),"D" ((long) (addr)):"cx","di")
20c20
< register int res ; \
---
> register int res __asm__("ax"); \
26c26
< register int res ; \
---
> register int res __asm__("ax"); \
44c44
< 	:"=c" (__res):"c" (0),"S" (addr)); \
---
> 	:"=c" (__res):"c" (0),"S" (addr):"ax","dx","si"); \
diff -r linux/fs/buffer.c linux.org/fs/buffer.c
288c288
< 	)
---
> 	:"cx","di","si")
diff -r linux/fs/Makefile linux.org/fs/Makefile
1,6c1,6
< AR	=ar
< AS	=as
< CC	=gcc -mcpu=i386
< LD	=ld
< CFLAGS	=-Wall -O -fstrength-reduce -fomit-frame-pointer \
< 	 -nostdinc -I../include
---
> AR	=gar
> AS	=gas
> CC	=gcc
> LD	=gld
> CFLAGS	=-Wall -O -fstrength-reduce -fcombine-regs -fomit-frame-pointer \
> 	-mstring-insns -nostdinc -I../include
35c35
< bitmap.o: bitmap.c ../include/string.h ../include/linux/sched.h \
---
> bitmap.o : bitmap.c ../include/string.h ../include/linux/sched.h \
37,38c37,38
<   ../include/linux/mm.h ../include/signal.h ../include/linux/kernel.h
< block_dev.o: block_dev.c ../include/errno.h ../include/linux/sched.h \
---
>   ../include/linux/mm.h ../include/signal.h ../include/linux/kernel.h 
> block_dev.o : block_dev.c ../include/errno.h ../include/linux/sched.h \
41,42c41,42
<   ../include/asm/segment.h ../include/asm/system.h
< buffer.o: buffer.c ../include/stdarg.h ../include/linux/config.h \
---
>   ../include/asm/segment.h ../include/asm/system.h 
> buffer.o : buffer.c ../include/stdarg.h ../include/linux/config.h \
45,46c45,46
<   ../include/linux/kernel.h ../include/asm/system.h ../include/asm/io.h
< char_dev.o: char_dev.c ../include/errno.h ../include/sys/types.h \
---
>   ../include/linux/kernel.h ../include/asm/system.h ../include/asm/io.h 
> char_dev.o : char_dev.c ../include/errno.h ../include/sys/types.h \
49,50c49,50
<   ../include/asm/segment.h ../include/asm/io.h
< exec.o: exec.c ../include/errno.h ../include/string.h \
---
>   ../include/asm/segment.h ../include/asm/io.h 
> exec.o : exec.c ../include/errno.h ../include/string.h \
54,55c54,55
<   ../include/asm/segment.h
< fcntl.o: fcntl.c ../include/string.h ../include/errno.h \
---
>   ../include/asm/segment.h 
> fcntl.o : fcntl.c ../include/string.h ../include/errno.h \
59,60c59,60
<   ../include/sys/stat.h
< file_dev.o: file_dev.c ../include/errno.h ../include/fcntl.h \
---
>   ../include/sys/stat.h 
> file_dev.o : file_dev.c ../include/errno.h ../include/fcntl.h \
63,65c63,65
<   ../include/linux/kernel.h ../include/asm/segment.h
< file_table.o: file_table.c ../include/linux/fs.h ../include/sys/types.h
< inode.o: inode.c ../include/string.h ../include/sys/stat.h \
---
>   ../include/linux/kernel.h ../include/asm/segment.h 
> file_table.o : file_table.c ../include/linux/fs.h ../include/sys/types.h 
> inode.o : inode.c ../include/string.h ../include/sys/stat.h \
68,69c68,69
<   ../include/linux/kernel.h ../include/asm/system.h
< ioctl.o: ioctl.c ../include/string.h ../include/errno.h \
---
>   ../include/linux/kernel.h ../include/asm/system.h 
> ioctl.o : ioctl.c ../include/string.h ../include/errno.h \
72,73c72,73
<   ../include/signal.h
< namei.o: namei.c ../include/linux/sched.h ../include/linux/head.h \
---
>   ../include/signal.h 
> namei.o : namei.c ../include/linux/sched.h ../include/linux/head.h \
77,78c77,78
<   ../include/const.h ../include/sys/stat.h
< open.o: open.c ../include/string.h ../include/errno.h ../include/fcntl.h \
---
>   ../include/const.h ../include/sys/stat.h 
> open.o : open.c ../include/string.h ../include/errno.h ../include/fcntl.h \
82,83c82,83
<   ../include/termios.h ../include/linux/kernel.h ../include/asm/segment.h
< pipe.o: pipe.c ../include/signal.h ../include/sys/types.h \
---
>   ../include/termios.h ../include/linux/kernel.h ../include/asm/segment.h 
> pipe.o : pipe.c ../include/signal.h ../include/sys/types.h \
85,86c85,86
<   ../include/linux/mm.h ../include/asm/segment.h
< read_write.o: read_write.c ../include/sys/stat.h ../include/sys/types.h \
---
>   ../include/linux/mm.h ../include/asm/segment.h 
> read_write.o : read_write.c ../include/sys/stat.h ../include/sys/types.h \
89,90c89,90
<   ../include/signal.h ../include/asm/segment.h
< stat.o: stat.c ../include/errno.h ../include/sys/stat.h \
---
>   ../include/signal.h ../include/asm/segment.h 
> stat.o : stat.c ../include/errno.h ../include/sys/stat.h \
93,94c93,94
<   ../include/linux/kernel.h ../include/asm/segment.h
< super.o: super.c ../include/linux/config.h ../include/linux/sched.h \
---
>   ../include/linux/kernel.h ../include/asm/segment.h 
> super.o : super.c ../include/linux/config.h ../include/linux/sched.h \
97,98c97,98
<   ../include/asm/system.h ../include/errno.h ../include/sys/stat.h
< truncate.o: truncate.c ../include/linux/sched.h ../include/linux/head.h \
---
>   ../include/asm/system.h ../include/errno.h ../include/sys/stat.h 
> truncate.o : truncate.c ../include/linux/sched.h ../include/linux/head.h \
100c100
<   ../include/signal.h ../include/sys/stat.h
---
>   ../include/signal.h ../include/sys/stat.h 
diff -r linux/fs/namei.c linux.org/fs/namei.c
65c65
< 	register int same ;
---
> 	register int same __asm__("ax");
76c76
< 		);
---
> 		:"cx","di","si");
diff -r linux/fs/super.c linux.org/fs/super.c
23c23
< register int __res ; \
---
> register int __res __asm__("ax"); \
diff -r linux/include/asm/memory.h linux.org/include/asm/memory.h
12c12
< 	); \
---
> 	:"di","si","cx"); \
diff -r linux/include/linux/kernel.h linux.org/include/linux/kernel.h
5c5
< //volatile void panic(const char * str);
---
> volatile void panic(const char * str);
diff -r linux/include/linux/sched.h linux.org/include/linux/sched.h
35d34
< #ifndef PANIC
37d35
< #endif
175c173
< __asm__("cmpl %%ecx,current\n\t" \
---
> __asm__("cmpl %%ecx,_current\n\t" \
178,180c176,178
< 	"xchgl %%ecx,current\n\t" \
< 	"ljmp *%0\n\t" \
< 	"cmpl %%ecx,last_task_used_math\n\t" \
---
> 	"xchgl %%ecx,_current\n\t" \
> 	"ljmp %0\n\t" \
> 	"cmpl %%ecx,_last_task_used_math\n\t" \
199c197
< 	)
---
> 	:"dx")
211c209
< 	)
---
> 	:"dx")
diff -r linux/include/string.h linux.org/include/string.h
34c34
< 	::"S" (src),"D" (dest));
---
> 	::"S" (src),"D" (dest):"si","di","ax");
50c50
< 	::"S" (src),"D" (dest),"c" (count));
---
> 	::"S" (src),"D" (dest),"c" (count):"si","di","ax","cx");
64c64
< 	::"S" (src),"D" (dest),"a" (0),"c" (0xffffffff));
---
> 	::"S" (src),"D" (dest),"a" (0),"c" (0xffffffff):"si","di","ax","cx");
84c84
< 	);
---
> 	:"si","di","ax","cx");
90c90
< register int __res ;
---
> register int __res __asm__("ax");
103c103
< 	:"=a" (__res):"D" (cs),"S" (ct));
---
> 	:"=a" (__res):"D" (cs),"S" (ct):"si","di");
109c109
< register int __res ;
---
> register int __res __asm__("ax");
124c124
< 	:"=a" (__res):"D" (cs),"S" (ct),"c" (count));
---
> 	:"=a" (__res):"D" (cs),"S" (ct),"c" (count):"si","di","cx");
130c130
< register char * __res ;
---
> register char * __res __asm__("ax");
141c141
< 	:"=a" (__res):"S" (s),"0" (c));
---
> 	:"=a" (__res):"S" (s),"0" (c):"si");
147c147
< register char * __res; 
---
> register char * __res __asm__("dx");
157c157
< 	:"=d" (__res):"0" (0),"S" (s),"a" (c));
---
> 	:"=d" (__res):"0" (0),"S" (s),"a" (c):"ax","si");
163c163
< register char * __res;
---
> register char * __res __asm__("si");
181c181
< 	);
---
> 	:"ax","cx","dx","di");
187c187
< register char * __res;
---
> register char * __res __asm__("si");
205c205
< 	);
---
> 	:"ax","cx","dx","di");
211c211
< register char * __res ;
---
> register char * __res __asm__("si");
232c232
< 	);
---
> 	:"ax","cx","dx","di");
238c238
< register char * __res ;
---
> register char * __res __asm__("ax");
259c259
< 	);
---
> 	:"cx","dx","di","si");
265c265
< register int __res ;
---
> register int __res __asm__("cx");
271c271
< 	:"=c" (__res):"D" (s),"a" (0),"0" (0xffffffff));
---
> 	:"=c" (__res):"D" (s),"a" (0),"0" (0xffffffff):"di");
279c279
< register char * __res ;
---
> register char * __res __asm__("si");
332c332
< 	);
---
> 	:"ax","cx","dx","di");
342c342
< 	);
---
> 	:"cx","si","di");
353c353
< 	);
---
> 	:"cx","si","di");
359c359
< 	);
---
> 	:"cx","si","di");
365c365
< register int __res ;
---
> register int __res __asm__("ax");
375c375
< 	);
---
> 	:"si","di","cx");
381c381
< register void * __res ;
---
> register void * __res __asm__("di");
391c391
< 	);
---
> 	:"cx");
401c401
< 	);
---
> 	:"cx","di");
diff -r linux/kernel/asm.s linux.org/kernel/asm.s
14,17c14,17
< .globl divide_error,debug,nmi,int3,overflow,bounds,invalid_op
< .globl double_fault,coprocessor_segment_overrun
< .globl invalid_TSS,segment_not_present,stack_segment
< .globl general_protection,coprocessor_error,irq13,reserved
---
> .globl _divide_error,_debug,_nmi,_int3,_overflow,_bounds,_invalid_op
> .globl _double_fault,_coprocessor_segment_overrun
> .globl _invalid_TSS,_segment_not_present,_stack_segment
> .globl _general_protection,_coprocessor_error,_irq13,_reserved
19,20c19,20
< divide_error:
< 	pushl $do_divide_error
---
> _divide_error:
> 	pushl $_do_divide_error
53,54c53,54
< debug:
< 	pushl $do_int3		# _do_debug
---
> _debug:
> 	pushl $_do_int3		# _do_debug
57,58c57,58
< nmi:
< 	pushl $do_nmi
---
> _nmi:
> 	pushl $_do_nmi
61,62c61,62
< int3:
< 	pushl $do_int3
---
> _int3:
> 	pushl $_do_int3
65,66c65,66
< overflow:
< 	pushl $do_overflow
---
> _overflow:
> 	pushl $_do_overflow
69,70c69,70
< bounds:
< 	pushl $do_bounds
---
> _bounds:
> 	pushl $_do_bounds
73,74c73,74
< invalid_op:
< 	pushl $do_invalid_op
---
> _invalid_op:
> 	pushl $_do_invalid_op
77,78c77,78
< coprocessor_segment_overrun:
< 	pushl $do_coprocessor_segment_overrun
---
> _coprocessor_segment_overrun:
> 	pushl $_do_coprocessor_segment_overrun
81,82c81,82
< reserved:
< 	pushl $do_reserved
---
> _reserved:
> 	pushl $_do_reserved
85c85
< irq13:
---
> _irq13:
95c95
< 	jmp coprocessor_error
---
> 	jmp _coprocessor_error
97,98c97,98
< double_fault:
< 	pushl $do_double_fault
---
> _double_fault:
> 	pushl $_do_double_fault
131,132c131,132
< invalid_TSS:
< 	pushl $do_invalid_TSS
---
> _invalid_TSS:
> 	pushl $_do_invalid_TSS
135,136c135,136
< segment_not_present:
< 	pushl $do_segment_not_present
---
> _segment_not_present:
> 	pushl $_do_segment_not_present
139,140c139,140
< stack_segment:
< 	pushl $do_stack_segment
---
> _stack_segment:
> 	pushl $_do_stack_segment
143,144c143,144
< general_protection:
< 	pushl $do_general_protection
---
> _general_protection:
> 	pushl $_do_general_protection
diff -r linux/kernel/blk_drv/floppy.c linux.org/kernel/blk_drv/floppy.c
158c158
< 	)
---
> 	:"cx","di","si")
diff -r linux/kernel/blk_drv/hd.c linux.org/kernel/blk_drv/hd.c
62c62
< __asm__("cld;rep;insw"::"d" (port),"D" (buf),"c" (nr))
---
> __asm__("cld;rep;insw"::"d" (port),"D" (buf),"c" (nr):"cx","di")
65c65
< __asm__("cld;rep;outsw"::"d" (port),"S" (buf),"c" (nr))
---
> __asm__("cld;rep;outsw"::"d" (port),"S" (buf),"c" (nr):"cx","si")
diff -r linux/kernel/blk_drv/Makefile linux.org/kernel/blk_drv/Makefile
9,11c9,11
< AR	=ar
< AS	=as
< LD	=ld
---
> AR	=gar
> AS	=gas
> LD	=gld
13,15c13,15
< CC	=gcc -mcpu=i386
< CFLAGS	=-Wall -O -fstrength-reduce -fomit-frame-pointer  \
< 	-finline-functions -nostdinc -I../../include
---
> CC	=gcc
> CFLAGS	=-Wall -O -fstrength-reduce -fomit-frame-pointer -fcombine-regs \
> 	-finline-functions -mstring-insns -nostdinc -I../../include
22c22
< 	$(AS) -o $*.o $<
---
> 	$(AS) -c -o $*.o $<
44,47c44,52
< floppy.s floppy.o: floppy.c ../../include/linux/sched.h ../../include/linux/head.h \
<   ../../include/linux/fs.h ../../include/sys/types.h \
<   ../../include/linux/mm.h ../../include/signal.h \
<   ../../include/linux/kernel.h ../../include/linux/fdreg.h \
---
> floppy.s floppy.o : floppy.c ../../include/linux/sched.h ../../include/linux/head.h \
>   ../../include/linux/fs.h ../../include/sys/types.h ../../include/linux/mm.h \
>   ../../include/signal.h ../../include/linux/kernel.h \
>   ../../include/linux/fdreg.h ../../include/asm/system.h \
>   ../../include/asm/io.h ../../include/asm/segment.h blk.h 
> hd.s hd.o : hd.c ../../include/linux/config.h ../../include/linux/sched.h \
>   ../../include/linux/head.h ../../include/linux/fs.h \
>   ../../include/sys/types.h ../../include/linux/mm.h ../../include/signal.h \
>   ../../include/linux/kernel.h ../../include/linux/hdreg.h \
49,50c54,55
<   ../../include/asm/segment.h blk.h
< hd.s hd.o: hd.c ../../include/linux/config.h ../../include/linux/sched.h \
---
>   ../../include/asm/segment.h blk.h 
> ll_rw_blk.s ll_rw_blk.o : ll_rw_blk.c ../../include/errno.h ../../include/linux/sched.h \
52,66c57,58
<   ../../include/sys/types.h ../../include/linux/mm.h \
<   ../../include/signal.h ../../include/linux/kernel.h \
<   ../../include/linux/hdreg.h ../../include/asm/system.h \
<   ../../include/asm/io.h ../../include/asm/segment.h blk.h
< ll_rw_blk.s ll_rw_blk.o: ll_rw_blk.c ../../include/errno.h \
<   ../../include/linux/sched.h ../../include/linux/head.h \
<   ../../include/linux/fs.h ../../include/sys/types.h \
<   ../../include/linux/mm.h ../../include/signal.h \
<   ../../include/linux/kernel.h ../../include/asm/system.h blk.h
< ramdisk.s ramdisk.o: ramdisk.c ../../include/string.h ../../include/linux/config.h \
<   ../../include/linux/sched.h ../../include/linux/head.h \
<   ../../include/linux/fs.h ../../include/sys/types.h \
<   ../../include/linux/mm.h ../../include/signal.h \
<   ../../include/linux/kernel.h ../../include/asm/system.h \
<   ../../include/asm/segment.h ../../include/asm/memory.h blk.h
---
>   ../../include/sys/types.h ../../include/linux/mm.h ../../include/signal.h \
>   ../../include/linux/kernel.h ../../include/asm/system.h blk.h 
diff -r linux/kernel/chr_drv/console.c linux.org/kernel/chr_drv/console.c
119c119
< 					"movl video_num_columns,%1\n\t"
---
> 					"movl _video_num_columns,%1\n\t"
126c126
< 					);
---
> 					:"cx","di","si");
137c137
< 					);
---
> 					:"cx","di");
144c144
< 				"movl video_num_columns,%%ecx\n\t"
---
> 				"movl _video_num_columns,%%ecx\n\t"
151c151
< 				);
---
> 				:"cx","di","si");
159c159
< 			"movl video_num_columns,%%ecx\n\t"
---
> 			"movl _video_num_columns,%%ecx\n\t"
166c166
< 			);
---
> 			:"cx","di","si");
178c178
< 			"movl video_num_columns,%%ecx\n\t"
---
> 			"movl _video_num_columns,%%ecx\n\t"
185c185
< 			);
---
> 			:"ax","cx","di","si");
193c193
< 			"movl video_num_columns,%%ecx\n\t"
---
> 			"movl _video_num_columns,%%ecx\n\t"
200c200
< 			);
---
> 			:"ax","cx","di","si");
265c265
< 		);
---
> 		:"cx","di");
296c296
< 		);
---
> 		:"cx","di");
461c461
< 					__asm__("movb attr,%%ah\n\t"
---
> 					__asm__("movb _attr,%%ah\n\t"
464c464
< 						);
---
> 						:"ax");
diff -r linux/kernel/chr_drv/keyboard.S linux.org/kernel/chr_drv/keyboard.S
16c16
< .globl keyboard_interrupt
---
> .globl _keyboard_interrupt
37c37
< keyboard_interrupt:
---
> _keyboard_interrupt:
47c47
< 	xor %al,%al		/* %eax is scan code */
---
> 	xorl %al,%al		/* %eax is scan code */
69c69
< 	call do_tty_interrupt
---
> 	call _do_tty_interrupt
91c91
< 	movl table_list,%edx		# read-queue for console
---
> 	movl _table_list,%edx		# read-queue for console
214c214
< 	call show_stat
---
> 	call _show_stat
diff -r linux/kernel/chr_drv/Makefile linux.org/kernel/chr_drv/Makefile
9,11c9,11
< AR	=ar
< AS	=as
< LD	=ld
---
> AR	=gar
> AS	=gas
> LD	=gld
13,15c13,15
< CC	=gcc -mcpu=i386
< CFLAGS	=-Wall -O -fstrength-reduce -fomit-frame-pointer \
< 	-finline-functions -nostdinc -I../../include
---
> CC	=gcc
> CFLAGS	=-Wall -O -fstrength-reduce -fomit-frame-pointer -fcombine-regs \
> 	-finline-functions -mstring-insns -nostdinc -I../../include
22c22
< 	$(AS) -o $*.o $<
---
> 	$(AS) -c -o $*.o $<
48c48
< console.s console.o: console.c ../../include/linux/sched.h \
---
> console.s console.o : console.c ../../include/linux/sched.h \
50,54c50,53
<   ../../include/sys/types.h ../../include/linux/mm.h \
<   ../../include/signal.h ../../include/linux/tty.h \
<   ../../include/termios.h ../../include/asm/io.h \
<   ../../include/asm/system.h
< serial.s serial.o: serial.c ../../include/linux/tty.h ../../include/termios.h \
---
>   ../../include/sys/types.h ../../include/linux/mm.h ../../include/signal.h \
>   ../../include/linux/tty.h ../../include/termios.h ../../include/asm/io.h \
>   ../../include/asm/system.h 
> serial.s serial.o : serial.c ../../include/linux/tty.h ../../include/termios.h \
56,59c55,57
<   ../../include/linux/fs.h ../../include/sys/types.h \
<   ../../include/linux/mm.h ../../include/signal.h \
<   ../../include/asm/system.h ../../include/asm/io.h
< tty_io.s tty_io.o: tty_io.c ../../include/ctype.h ../../include/errno.h \
---
>   ../../include/linux/fs.h ../../include/sys/types.h ../../include/linux/mm.h \
>   ../../include/signal.h ../../include/asm/system.h ../../include/asm/io.h 
> tty_io.s tty_io.o : tty_io.c ../../include/ctype.h ../../include/errno.h \
62,65c60,63
<   ../../include/linux/fs.h ../../include/linux/mm.h \
<   ../../include/linux/tty.h ../../include/termios.h \
<   ../../include/asm/segment.h ../../include/asm/system.h
< tty_ioctl.s tty_ioctl.o: tty_ioctl.c ../../include/errno.h ../../include/termios.h \
---
>   ../../include/linux/fs.h ../../include/linux/mm.h ../../include/linux/tty.h \
>   ../../include/termios.h ../../include/asm/segment.h \
>   ../../include/asm/system.h 
> tty_ioctl.s tty_ioctl.o : tty_ioctl.c ../../include/errno.h ../../include/termios.h \
67,71c65,68
<   ../../include/linux/fs.h ../../include/sys/types.h \
<   ../../include/linux/mm.h ../../include/signal.h \
<   ../../include/linux/kernel.h ../../include/linux/tty.h \
<   ../../include/asm/io.h ../../include/asm/segment.h \
<   ../../include/asm/system.h
---
>   ../../include/linux/fs.h ../../include/sys/types.h ../../include/linux/mm.h \
>   ../../include/signal.h ../../include/linux/kernel.h \
>   ../../include/linux/tty.h ../../include/asm/io.h \
>   ../../include/asm/segment.h ../../include/asm/system.h 
diff -r linux/kernel/chr_drv/rs_io.s linux.org/kernel/chr_drv/rs_io.s
14c14
< .globl rs1_interrupt,rs2_interrupt
---
> .globl _rs1_interrupt,_rs2_interrupt
34,35c34,35
< rs1_interrupt:
< 	pushl $table_list+8
---
> _rs1_interrupt:
> 	pushl $_table_list+8
38,39c38,39
< rs2_interrupt:
< 	pushl $table_list+16
---
> _rs2_interrupt:
> 	pushl $_table_list+16
98c98
< 	subl $table_list,%edx
---
> 	subl $_table_list,%edx
109c109
< 	call do_tty_interrupt
---
> 	call _do_tty_interrupt
diff -r linux/kernel/Makefile linux.org/kernel/Makefile
9,11c9,11
< AR	=ar
< AS	=as
< LD	=ld
---
> AR	=gar
> AS	=gas
> LD	=gld
13,15c13,15
< CC	=gcc -mcpu=i386
< CFLAGS	=-Wall -O2 -fstrength-reduce -fomit-frame-pointer \
< 	-finline-functions -nostdinc -I../include
---
> CC	=gcc
> CFLAGS	=-Wall -O -fstrength-reduce -fomit-frame-pointer -fcombine-regs \
> 	-finline-functions -mstring-insns -nostdinc -I../include
22c22
< 	$(AS) -o $*.o $<
---
> 	$(AS) -c -o $*.o $<
51c51
< exit.s exit.o: exit.c ../include/errno.h ../include/signal.h \
---
> exit.s exit.o : exit.c ../include/errno.h ../include/signal.h \
55,56c55,56
<   ../include/asm/segment.h
< fork.s fork.o: fork.c ../include/errno.h ../include/linux/sched.h \
---
>   ../include/asm/segment.h 
> fork.s fork.o : fork.c ../include/errno.h ../include/linux/sched.h \
59,61c59,61
<   ../include/asm/segment.h ../include/asm/system.h
< mktime.s mktime.o: mktime.c ../include/time.h
< panic.s panic.o: panic.c ../include/linux/kernel.h ../include/linux/sched.h \
---
>   ../include/asm/segment.h ../include/asm/system.h 
> mktime.s mktime.o : mktime.c ../include/time.h 
> panic.s panic.o : panic.c ../include/linux/kernel.h ../include/linux/sched.h \
63,66c63,66
<   ../include/linux/mm.h ../include/signal.h
< printk.s printk.o: printk.c ../include/stdarg.h ../include/stddef.h \
<   ../include/linux/kernel.h
< sched.s sched.o: sched.c ../include/linux/sched.h ../include/linux/head.h \
---
>   ../include/linux/mm.h ../include/signal.h 
> printk.s printk.o : printk.c ../include/stdarg.h ../include/stddef.h \
>   ../include/linux/kernel.h 
> sched.s sched.o : sched.c ../include/linux/sched.h ../include/linux/head.h \
70,71c70,71
<   ../include/asm/segment.h
< signal.s signal.o: signal.c ../include/linux/sched.h ../include/linux/head.h \
---
>   ../include/asm/segment.h 
> signal.s signal.o : signal.c ../include/linux/sched.h ../include/linux/head.h \
73,74c73,74
<   ../include/signal.h ../include/linux/kernel.h ../include/asm/segment.h
< sys.s sys.o: sys.c ../include/errno.h ../include/linux/sched.h \
---
>   ../include/signal.h ../include/linux/kernel.h ../include/asm/segment.h 
> sys.s sys.o : sys.c ../include/errno.h ../include/linux/sched.h \
78,79c78,79
<   ../include/sys/times.h ../include/sys/utsname.h
< traps.s traps.o: traps.c ../include/string.h ../include/linux/head.h \
---
>   ../include/sys/times.h ../include/sys/utsname.h 
> traps.s traps.o : traps.c ../include/string.h ../include/linux/head.h \
82,83c82,83
<   ../include/asm/system.h ../include/asm/segment.h ../include/asm/io.h
< vsprintf.s vsprintf.o: vsprintf.c ../include/stdarg.h ../include/string.h
---
>   ../include/asm/system.h ../include/asm/segment.h ../include/asm/io.h 
> vsprintf.s vsprintf.o : vsprintf.c ../include/stdarg.h ../include/string.h 
diff -r linux/kernel/math/Makefile linux.org/kernel/math/Makefile
9,11c9,11
< AR	=ar
< AS	=as
< LD	=ld
---
> AR	=gar
> AS	=gas
> LD	=gld
13,15c13,15
< CC	=gcc -mcpu=i386
< CFLAGS	=-Wall -O -fstrength-reduce -fomit-frame-pointer \
< 	-finline-functions -nostdinc -I../../include
---
> CC	=gcc
> CFLAGS	=-Wall -O -fstrength-reduce -fomit-frame-pointer -fcombine-regs \
> 	-finline-functions -mstring-insns -nostdinc -I../../include
22c22
< 	$(AS) -o $*.o $<
---
> 	$(AS) -c -o $*.o $<
diff -r linux/kernel/panic.c linux.org/kernel/panic.c
11,12d10
< #define PANIC
< 
diff -r linux/kernel/printk.c linux.org/kernel/printk.c
33c33
< 		"pushl $buf\n\t"
---
> 		"pushl $_buf\n\t"
35c35
< 		"call tty_write\n\t"
---
> 		"call _tty_write\n\t"
diff -r linux/kernel/system_call.s linux.org/kernel/system_call.s
67,69c67,69
< .globl system_call,sys_fork,timer_interrupt,sys_execve
< .globl hd_interrupt,floppy_interrupt,parallel_interrupt
< .globl device_not_available, coprocessor_error
---
> .globl _system_call,_sys_fork,_timer_interrupt,_sys_execve
> .globl _hd_interrupt,_floppy_interrupt,_parallel_interrupt
> .globl _device_not_available, _coprocessor_error
78c78
< 	jmp schedule
---
> 	jmp _schedule
80c80
< system_call:
---
> _system_call:
94c94
< 	call sys_call_table(,%eax,4)
---
> 	call _sys_call_table(,%eax,4)
96c96
< 	movl current,%eax
---
> 	movl _current,%eax
102,103c102,103
< 	movl current,%eax		# task[0] cannot have signals
< 	cmpl task,%eax
---
> 	movl _current,%eax		# task[0] cannot have signals
> 	cmpl _task,%eax
119c119
< 	call do_signal
---
> 	call _do_signal
131c131
< coprocessor_error:
---
> _coprocessor_error:
145c145
< 	jmp math_error
---
> 	jmp _math_error
148c148
< device_not_available:
---
> _device_not_available:
165c165
< 	je math_state_restore
---
> 	je _math_state_restore
169c169
< 	call math_emulate
---
> 	call _math_emulate
176c176
< timer_interrupt:
---
> _timer_interrupt:
189c189
< 	incl jiffies
---
> 	incl _jiffies
195c195
< 	call do_timer		# 'do_timer(long CPL)' does everything from
---
> 	call _do_timer		# 'do_timer(long CPL)' does everything from
200c200
< sys_execve:
---
> _sys_execve:
203c203
< 	call do_execve
---
> 	call _do_execve
208,209c208,209
< sys_fork:
< 	call find_empty_process
---
> _sys_fork:
> 	call _find_empty_process
217c217
< 	call copy_process
---
> 	call _copy_process
221c221
< hd_interrupt:
---
> _hd_interrupt:
238c238
< 	xchgl do_hd,%edx
---
> 	xchgl _do_hd,%edx
241c241
< 	movl $unexpected_hd_interrupt,%edx
---
> 	movl $_unexpected_hd_interrupt,%edx
252c252
< floppy_interrupt:
---
> _floppy_interrupt:
267c267
< 	xchgl do_floppy,%eax
---
> 	xchgl _do_floppy,%eax
270c270
< 	movl $unexpected_floppy_interrupt,%eax
---
> 	movl $_unexpected_floppy_interrupt,%eax
280c280
< parallel_interrupt:
---
> _parallel_interrupt:
diff -r linux/lib/Makefile linux.org/lib/Makefile
9,11c9,11
< AR	=ar
< AS	=as
< LD	=ld
---
> AR	=gar
> AS	=gas
> LD	=gld
13,15c13,15
< CC	=gcc -mcpu=i386
< CFLAGS	=-Wall -O -fstrength-reduce -fomit-frame-pointer \
< 	-finline-functions -nostdinc -I../include
---
> CC	=gcc
> CFLAGS	=-Wall -O -fstrength-reduce -fomit-frame-pointer -fcombine-regs \
> 	-finline-functions -mstring-insns -nostdinc -I../include
22c22
< 	$(AS) -o $*.o $<
---
> 	$(AS) -c -o $*.o $<
diff -r linux/Makefile linux.org/Makefile
5c5
< RAMDISK =  #-DRAMDISK=512
---
> RAMDISK = #-DRAMDISK=512
10,15c10,15
< AS	=as
< LD	=ld
< LDFLAGS	=-m elf_i386 -Ttext 0 -e startup_32
< CC	=gcc -mcpu=i386 $(RAMDISK)
< CFLAGS	=-Wall -O2 -fomit-frame-pointer 
< 
---
> AS	=gas
> LD	=gld
> LDFLAGS	=-s -x -M
> CC	=gcc $(RAMDISK)
> CFLAGS	=-Wall -O -fstrength-reduce -fomit-frame-pointer \
> -fcombine-regs -mstring-insns
23c23
< ROOT_DEV=FLOPPY 
---
> ROOT_DEV=/dev/hd6
34c34
< 	$(AS)  -o $*.o $<
---
> 	$(AS) -c -o $*.o $<
42,44c42
< 	objcopy -O binary -R .note -R .comment tools/system tools/kernel
< 	tools/build boot/bootsect boot/setup tools/kernel $(ROOT_DEV) > Image
< 	rm tools/kernel -f
---
> 	tools/build boot/bootsect boot/setup tools/system $(ROOT_DEV) > Image
48c46
< 	dd bs=8192 if=Image of=/dev/fd0
---
> 	dd bs=8192 if=Image of=/dev/PS0
55,56d52
< 	gcc -I./include -traditional -c boot/head.s
< 	mv head.o boot/
65,66c61
< 	-o tools/system 
< 	nm tools/system | grep -v '\(compiled\)\|\(\.o$$\)\|\( [aU] \)\|\(\.\.ng$$\)\|\(LASH[RL]DI\)'| sort > System.map 
---
> 	-o tools/system > System.map
111c106
< 	(cd .. ; tar cf - linux | compress16 - > backup.Z)
---
> 	(cd .. ; tar cf - linux | compress - > backup.Z)
123c118
< init/main.o: init/main.c include/unistd.h include/sys/stat.h \
---
> init/main.o : init/main.c include/unistd.h include/sys/stat.h \
127,128c122,123
<   include/linux/mm.h include/signal.h include/asm/system.h \
<   include/asm/io.h include/stddef.h include/stdarg.h include/fcntl.h
---
>   include/linux/mm.h include/signal.h include/asm/system.h include/asm/io.h \
>   include/stddef.h include/stdarg.h include/fcntl.h 
diff -r linux/mm/Makefile linux.org/mm/Makefile
1,2c1,2
< CC	=gcc -mcpu=i386
< CFLAGS	=-O -Wall -fstrength-reduce -fomit-frame-pointer \
---
> CC	=gcc
> CFLAGS	=-O -Wall -fstrength-reduce -fcombine-regs -fomit-frame-pointer \
4,6c4,6
< AS	=as
< AR	=ar
< LD	=ld
---
> AS	=gas
> AR	=gar
> LD	=gld
35,38c35,37
< memory.o: memory.c ../include/signal.h ../include/sys/types.h \
<   ../include/asm/system.h ../include/linux/sched.h \
<   ../include/linux/head.h ../include/linux/fs.h ../include/linux/mm.h \
<   ../include/linux/kernel.h
---
> memory.o : memory.c ../include/signal.h ../include/sys/types.h \
>   ../include/asm/system.h ../include/linux/sched.h ../include/linux/head.h \
>   ../include/linux/fs.h ../include/linux/mm.h ../include/linux/kernel.h 
diff -r linux/mm/memory.c linux.org/mm/memory.c
55c55
< __asm__("cld ; rep ; movsl"::"S" (from),"D" (to),"c" (1024))
---
> __asm__("cld ; rep ; movsl"::"S" (from),"D" (to),"c" (1024):"cx","di","si")
81c81
< 	);
---
> 	:"di","cx","dx");
diff -r linux/mm/page.s linux.org/mm/page.s
12c12
< .globl page_fault
---
> .globl _page_fault
14c14
< page_fault:
---
> _page_fault:
30c30
< 	call do_no_page
---
> 	call _do_no_page
32c32
< 1:	call do_wp_page
---
> 1:	call _do_wp_page
diff -r linux/tools/build.c linux.org/tools/build.c
35c35
< #define SYS_SIZE 0x3000
---
> #define SYS_SIZE 0x2000
156,159c156,159
< //	if (read(id,buf,GCC_HEADER) != GCC_HEADER)
< //		die("Unable to read header of 'system'");
< //	if (((long *) buf)[5] != 0)
< //		die("Non-GCC header of 'system'");
---
> 	if (read(id,buf,GCC_HEADER) != GCC_HEADER)
> 		die("Unable to read header of 'system'");
> 	if (((long *) buf)[5] != 0)
> 		die("Non-GCC header of 'system'");
